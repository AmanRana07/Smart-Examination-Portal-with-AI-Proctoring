<!DOCTYPE html>
{% load static %}
<html lang="en" dir="ltr">

<head>
    <style>
        .jumbotron {
            margin-bottom: 0px;
        }

        /* Chatbot Styles */
        #chatbot-container {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: linear-gradient(135deg, #007bff, #00c6ff); /* Gradient background */
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            z-index: 1000;
            opacity: 0;
            transform: translateY(100%);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        #chatbot-container.show {
            opacity: 1;
            transform: translateY(0);
            display: flex;
        }

       /* Chatbot Header Styling */
#chatbot-header {
    display: flex;
    align-items: center;
    background-color: #003366;
    color: white;
    padding: 15px;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
    position: relative;
    font-weight: bold;
    font-size: 18px;
}

/* Avatar Styling */
#chatbot-avatar {
    width: 100px!important;/* Slightly larger avatar */
    height: 80px;
    border-radius: 50%;
    margin-right: 30px; /* Space between avatar and text */
}

/* Header Text Styling */
#chatbot-header-text {
    display: flex;
    flex-direction: column;
}

/* Main Greeting Text */
#chatbot-header-text span {
    font-size: 18px;
    font-weight: bold;
    margin: 0;
}

/* Subtitle Text */
#chatbot-header-text p {
    font-size: 14px;
    color: #e0e0e0;
    margin: 5px 0 0;

    text-align: justify!important;
}

/* Close Button Styling */
#chatbot-close {
    display: none;
    position: absolute;
    top: 0px;
    right: 15px;
    font-size: 20px;
    cursor: pointer;
    color: white;
}

        #chatbot-messages {
            padding: 15px;
            height: 350px;
            overflow-y: auto;
            flex: 1;
            background-color:#f9f9f9; /* Light background for messages */
        }

        /* Add some margin to each message for spacing */
.message {
    margin-bottom: 12px;
    max-width: 85%; /* Reduce max-width slightly for better layout */
    word-wrap: break-word; /* Ensure long words are wrapped */
}

        /* Styles for bot messages (Senpai) */
.message.bot-message {
    background-color:  /* Primary blue color for bot messages */
    color: #f2f2f;
    margin-left: 0; /* Align to the left */
    margin-right: auto; /* Push to the left side */
    text-align: left; /* Ensure text is aligned left */
    padding: 10px 15px; /* Add padding for better spacing */
    border-radius: 15px 15px 15px 0; /* Rounded corners with a flat side on the right */
    width: max-content!important;
    font-size: 16px; /* Slightly increase font size */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15); /* Add subtle shadow for depth */
}

.message.user-message {
    background-color: #007bff; /* Blue color for user messages */
    color: white;
    margin-left: auto!important; /* Align to the right */
    margin-right: 0!important; /* Push to the right side */
    text-align: right; /* Ensure text is aligned right */
    padding: 10px 15px; /* Add padding for better spacing */
    border-radius: 15px 15px 0 15px; /* Rounded corners with a flat side on the left */
    font-size: 16px; /* Slightly increase font size */
    box-shadow: 0 4px 5px rgba(0, 51, 104, 0.3); /* Slight blue-tinted shadow for depth */
    /* Allow the width to fit content */ 
    width: max-content!important;
 /* Set width to auto to fit the content */
    word-wrap: break-word; /* Ensure long words are wrapped */
}

        #chatbot-input-container {
            display: flex;
            padding: 10px;
            border-top: 1px solid #ddd;
            background-color: #ffffff;
        }

        #chatbot-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 16px;
        }

        #chatbot-send {
            margin-left: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        #chatbot-send:hover {
            background-color: #003366;
        }

        #chatbot-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px; /* Smaller size */
            height: 50px; /* Smaller size */
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px; /* Smaller icon size */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            transition: background-color 0.3s ease;
        }

        #chatbot-toggle:hover {
            background-color: #007bff;
        }

        #chatbot-toggle-icon {
            display: inline-block;
        }

        .cross-icon {
            font-size: 24px; /* Smaller icon size */
            color: white;
        }

        /* Typing indicator styles */
        .typing-indicator {
            margin-left: 0; /* Align to the left */
            margin-right: auto; /* Push to the left side */
            font-style: italic;
            color: #007bff; /* Matches the bot message color */
        }

        .typing-dots::after {
            content: '...';
            animation: ellipsis 1.5s infinite;
        }

        @keyframes ellipsis {
            0% {
                content: '.';
            }
            33% {
                content: '..';
            }
            66% {
                content: '...';
            }
            100% {
                content: '';
            }
        }

    
            #chatbot-avatar {
                width: 50px;
                height: 50px;
                border-radius: 50%; /* Optional: make it circular */
            }
        
        
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    {% include "exam/navbar.html" %}
    <br>
    <section id="section-jumbotron" class="jumbotron jumbotron-fluid d-flex justify-content-center align-items-center">
        <div class="container text-center">
            <h2 class="display-3 text-info">TestMate</h2>
            <p class="display-4 d-none d-sm-block">Attend your examinations online!</p>
            <p class="lead">Sign up now to give your first online examination</p>

            <p><strong> Start Your Journey Here:</strong></p>
            <a href="/student/studentsignup" class="btn btn-lg btn-info"
                style="padding-right: 35px; border-radius: 0%;"><i class="fa fa-graduation-cap"
                    aria-hidden="true"></i> Sign Up as Student</a>

            <br><br><br>
        </div>
    </section>
    {% include "exam/footer.html" %}

    <!-- Chatbot Container -->
    <div id="chatbot-container">
        <div id="chatbot-header">
            <img src="{% static "image/avatar.webp" %}" id="chatbot-avatar" alt="Avatar">
            <div id="chatbot-header-text">
                <span>Hi, Iâ€™m Senp-AI!</span>
                <p>Iâ€™m here to help. So, if you have any questions, go ahead and ask me!</p>
            </div>
            <span id="chatbot-close" onclick="closeChatbot()">Ã—</span>
        </div>
        <div id="chatbot-messages"></div>
        <div id="chatbot-input-container">
            <input type="text" id="chatbot-input" placeholder="Enter your question">
            <button id="chatbot-send" onclick="sendMessage()">&#9658;</button>
        </div>
    </div>

    <!-- Chatbot Toggle Button -->
    <button id="chatbot-toggle" aria-hidden="true" onclick="toggleChatbot()">
        <span id="chatbot-toggle-icon" class="cross-icon">ðŸ’¬</span>
    </button>

    <script>
        let isFirstOpen = true; // Flag to check if it's the first open

        // Toggle chatbot visibility and change icon
        function toggleChatbot() {
            const chatbotContainer = document.getElementById('chatbot-container');
            const toggleIcon = document.getElementById('chatbot-toggle-icon');

            if (chatbotContainer.classList.contains('show')) {
                chatbotContainer.classList.remove('show');
                setTimeout(() => {
                    chatbotContainer.style.display = 'none'; // Hide completely after transition
                }, 300); // Match the duration of the CSS transition
                toggleIcon.textContent = 'ðŸ’¬'; // Change to chat icon
            } else {
                chatbotContainer.style.display = 'flex'; // Ensure it's displayed before animation
                setTimeout(() => {
                    chatbotContainer.classList.add('show');
                }, 10); // Slight delay to ensure the display change is registered
                toggleIcon.textContent = ''; // Change to cross icon

                // Send welcome message if it's the first time opening
                if (isFirstOpen) {
                    isFirstOpen = false; // Set flag to false after first use

                    // Send a request to get the welcome message
                    fetch('/chatbot/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        body: JSON.stringify({ message: 'start' }) // Trigger welcome message
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.response) {
                            addMessage(data.response, 'bot-message'); // Add welcome message from bot
                        }
                    })
                    .catch(error => console.error('Error fetching welcome message:', error));
                }
            }
        }

        // Function to add a message to the chat
        function addMessage(message, className) {
            const messageElement = document.createElement('div');
            messageElement.className = `message ${className}`;
            messageElement.textContent = message;
            document.getElementById('chatbot-messages').appendChild(messageElement);
            document.getElementById('chatbot-messages').scrollTop = document.getElementById('chatbot-messages').scrollHeight;
        }

        // Event listener to send message on Enter key press
        document.getElementById('chatbot-input').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
                event.preventDefault(); // Prevent default form submission if any
            }
        });

        // Function to handle sending of messages
        function sendMessage() {
            const inputElement = document.getElementById('chatbot-input');
            const message = inputElement.value.trim();

            if (message === '') return; // Ignore empty messages

            addMessage(message, 'user-message'); // Add user message to chat

            inputElement.value = ''; // Clear input field

            // Send user message to backend for processing
            fetch('/chatbot/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ message: message })
            })
            .then(response => response.json())
            .then(data => {
                if (data.response) {
                    addMessage(data.response, 'bot-message'); // Add bot response
                }
            })
            .catch(error => console.error('Error sending message:', error));
        }

        // Close chatbot
        function closeChatbot() {
            document.getElementById('chatbot-container').classList.remove('show');
        }
        // Adjust chat icon dynamically
        setInterval(function () {
            if ($('#chatbot-toggle-icon').is(':empty')) {
                $('#chatbot-toggle-icon').html('<i class="fa-solid fa-xmark"></i>')
            }
        }, 100);
    </script>
</body>

</html>
